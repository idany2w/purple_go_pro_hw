# Order API

API для управления заказами пользователей с системой аутентификации.

## Структура проекта

```
4-order-api/
├── cmd/
│   └── main.go                 # Точка входа приложения
├── configs/                     # Конфигурации
├── internal/                    # Внутренняя логика
│   ├── auth/                    # Аутентификация
│   ├── order/                   # Заказы
│   │   ├── model.go            # Модели заказов
│   │   ├── repository.go       # Репозиторий заказов
│   │   ├── service.go          # Бизнес-логика заказов
│   │   └── handler.go          # HTTP хендлеры
│   ├── product/                 # Продукты
│   │   ├── model.go            # Модели продуктов
│   │   ├── repository.go       # Репозиторий продуктов
│   │   └── handler.go          # HTTP хендлеры
│   ├── sms/                     # SMS сервис
│   └── user/                    # Пользователи
│       ├── model.go            # Модели пользователей
│       └── repository.go       # Репозиторий пользователей
├── migrations/
│   └── auto.go                 # Автоматические миграции GORM
├── pkg/                         # Общие пакеты
├── go.mod                       # Зависимости Go
├── go.sum                       # Хеши зависимостей
├── docker-compose.yml           # Docker Compose для базы данных
└── README.md                    # Этот файл
```

## Модели данных

### User (Пользователь)

- `id` - уникальный идентификатор
- `phone` - номер телефона (уникальный)
- `orders` - связь с заказами (1:N)

### Product (Продукт)

- `id` - уникальный идентификатор
- `name` - название продукта
- `description` - описание продукта
- `images` - массив изображений
- `order_items` - связь с элементами заказов

### Order (Заказ)

- `id` - уникальный идентификатор
- `user_id` - ID пользователя
- `status` - статус заказа (pending, confirmed, shipped, delivered, cancelled)
- `total_amount` - общая сумма заказа
- `order_items` - элементы заказа (N:M связь с продуктами)

### OrderItem (Элемент заказа)

- `id` - уникальный идентификатор
- `order_id` - ID заказа
- `product_id` - ID продукта
- `quantity` - количество
- `price` - цена за единицу

## API Endpoints

### Аутентификация

- `POST /auth/register` - регистрация пользователя (отправка SMS)
- `POST /auth/login` - вход пользователя (подтверждение SMS)

### Заказы

- `POST /order` - создание нового заказа
- `GET /order/{id}` - получение заказа по ID
- `GET /my-orders` - получение заказов текущего пользователя

### Продукты

- `GET /products` - получение списка продуктов
- `GET /products/{id}` - получение продукта по ID
- `POST /products` - создание нового продукта
- `PUT /products/{id}` - обновление продукта
- `DELETE /products/{id}` - удаление продукта

## Запуск проекта

### 1. Запуск базы данных

```bash
docker-compose up -d
```

### 2. Запуск приложения

```bash
go run cmd/main.go
```

Приложение автоматически:

- Создаст все необходимые таблицы в базе данных
- Добавит тестовые данные (пользователь и продукты)
- Запустит HTTP сервер

## Примеры использования

### Создание заказа

```bash
curl -X POST http://localhost:8080/order \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "product_ids": [1, 2],
    "quantities": [2, 1]
  }'
```

### Получение заказа по ID

```bash
curl http://localhost:8080/order/1
```

### Получение заказов пользователя

```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8080/my-orders
```

## Технологии

- **Go 1.25+** - основной язык
- **GORM** - ORM для работы с базой данных
- **PostgreSQL** - база данных
- **JWT** - аутентификация
- **Docker** - контейнеризация

## Особенности реализации

1. **Автоматические миграции** - GORM автоматически создает таблицы на основе моделей
2. **Связи между таблицами** - правильно настроены внешние ключи и связи
3. **Валидация данных** - проверка входных данных на уровне сервиса
4. **Обработка ошибок** - детальные сообщения об ошибках
5. **Логирование** - структурированное логирование всех операций
